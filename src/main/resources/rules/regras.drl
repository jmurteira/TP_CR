//created on: 01-Jul-2019
import com.sample.Clientes;
import com.sample.Items;
import com.sample.Fatura;
import java.util.Scanner;



//declare any global variables here

rule "Registo de Cliente"
    salience 100
    when
    then
    	String Nome = "";
    	String EstadoCivil = "";
    	String Sexo = "";
    	Boolean Filhos = false;
    	
    	char s;
    	char e;
    	char f;
    
        System.out.println("Nome do Cliente?");
        Scanner input1 = new Scanner(System.in);
        Nome = input1.nextLine();

        System.out.println("Sexo:");
        System.out.println("feminino (f) | masculino (m):");
        
        s = (char)System.in.read();
        System.in.read(new byte[System.in.available()]);

            while (s != 'm' && s != 'f')
        	{
        		System.out.println("Introduza carater válido! (m/f)");            	
            	s = (char)System.in.read();
            	System.in.read(new byte[System.in.available()]);
           	}
        if(s == 'f')
           	Sexo = "feminino";
        if(s == 'm')
            Sexo = "masculino";
            
        System.out.println("EstadoCivil:");
        System.out.println("solteiro(a) (s) | casado(a) (c):");
        
        e = (char)System.in.read();
        System.in.read(new byte[System.in.available()]);

            while (e != 's' && e != 'c')
        	{
            	System.out.println("Introduza carater válido! (s/c)");
            	e = (char)System.in.read();
            	System.in.read(new byte[System.in.available()]);
           	}
        if(e == 's')
            EstadoCivil = "solteiro";
        if(e == 'c')
            EstadoCivil = "casado";

        System.out.println("Tem filhos:");
        System.out.println("sim (s) | não (n):");
        
        f = (char)System.in.read();
        System.in.read(new byte[System.in.available()]);

            while (f != 's' && f != 'n')
        	{
        		System.out.println("Introduza carater válido! (s/n)");
            	f = (char)System.in.read();
        		System.in.read(new byte[System.in.available()]);
           	}
        if(f == 's')
            Filhos = true;
        if(f == 'n')
            Filhos = false;


        insert (new Clientes(Nome, Sexo, EstadoCivil, Filhos));       
        //System.out.println("MOSTRAR DADOS: " + Nome + " " + Sexo + " " + EstadoCivil);        
end

rule "Deseja comprar algo?"
salience 90
when 
	not Fatura()	
	then
		char resposta;
		System.out.println("Deseja escolher algum item? (S/N)");
        resposta = (char)System.in.read();
		
		if(resposta == 'N')
        {
        	System.out.println("Obrigado pela sua visita!");
        	System.exit(0);
        }
        if(resposta == 'S')
        {
        
        	//criar fatura nova
        	insert ( new Fatura(0,0,0) );
        	//drools.setFocus("Mostrar");        	
        }	
end

rule "Mostrar items disponíveis"
	//agenda-group "Mostrar"
	salience 80
	when
		exists Fatura()
		$c:Clientes()
		$i:Items( ( sexo == $c.getSexo() ) && stock > 0)		
	then		
		System.out.println("Item " + $i.getId() + ": " + $i.getNome() + " (para " + $i.getTipo() + ", " + $i.getSexo() + ")" + ", preço: " + $i.getPreco());	   	
end

rule "Escolher Item"
no-loop
	salience 70
	when
		$f:Fatura()
	then		
		int id;
		System.out.printf("Informe o ID da peça (0 para sair): ");
		Scanner ler = new Scanner(System.in);
		id = ler.nextInt();
		
		$f.setIdAtual(id);
		update($f);
		
		//System.out.printf("ID FATURA: " + $f.getIdAtual());
		
end

rule "Atualiza Fatura e Stock"
no-loop
salience 69
when
	$f:Fatura()
	$i:Items( id == $f.getIdAtual() )
then
	$f.setnItems($f.getnItems() + 1 );
	$f.setPrecoTotal($f.getPrecoTotal() + $i.getPreco() );
	$i.setStock($i.getStock() - 1 );
	
	update($f);
	update($i);
	
	System.out.println("Item Adicionado: " + $i.getNome() + ", Preço: " + $i.getPreco());
	//System.out.println("ITEMS: " + $f.getnItems());
	System.out.println("PRECO TOTAL: " + $f.getPrecoTotal());
end

rule "Tem filhos?"
no-loop
salience 60
when
	$f:Fatura( nItems > 0 )
	$c:Clientes( filhos == true )
then
	if  ( $c.getSexo() == "masculino" )
		drools.setFocus("HomemFilhos"); 
		
	if  ( $c.getSexo() == "feminino" )
		drools.setFocus("MulherFilhos");
		
	//implementar compra
end

rule "Homem com filhos"
no-loop
agenda-group "HomemFilhos"
then
	System.out.println("Deseja comprar uma camisola para o seu filho \"O MEU PAPA É O MELHOR\"? ");
	//implementar compra
end

rule "Mulher com filhos"
no-loop
agenda-group "MulherFilhos"
then
	System.out.println("Deseja comprar uma camisola para o seu filho \"A MINHA MAE É A MELHOR\"? ");
	//implementar compra
end

rule "Casado sem filhos?"
no-loop
salience 59
when
	$f:Fatura( nItems > 0 )
	$c:Clientes( estado_civil == "casado" && filhos == false )
then
	System.out.println("AMO TE");
	//implementar compra
end

rule "Solteiro sem filhos?"
no-loop
salience 58
when
	$f:Fatura( nItems > 0 )
	$c:Clientes( estado_civil == "solteiro" && filhos == false )
then
	System.out.println("SÓ PARA MIM");
	//implementar compra
end

/*
rule "Escolher Mais?"
	salience 60
	when
		exists Fatura()
	then		
		char resposta;
		System.out.println("Deseja escolher mais items da lista? (S/N)");
		Scanner ler = new Scanner(System.in);
        resposta = (char)System.in.read();
		
		if(resposta == 'N')
        {
        	// FINALIZAR COMPRA
        }
        if(resposta == 'S')
        {
        	
        	System.out.printf("SIM");        
        	drools.setFocus("Mostrar");
        	
        }
			
end
*/